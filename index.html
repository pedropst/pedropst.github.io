<html>
    <head>
        <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css"/>
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    </head>
    <body>
        <div style="justify-content: spaceBetween; display:inline">
            <div id="search_part", style="display: inline;">
                <p>Buscar</p>
                <input type="text" id="search_input">
                <button id="search-submit" type="submit" pys-onClick="search">OK</button>
                <div id="search-output"></div>
            </div>
            <div id="order_part", style="display: inline;">
                <p>Ordenar</p>
                <input type="text" id="order_input">
                <button id="order-submit" type="submit" pys-onClick="order_by">OK</button>
                <div id="order-output"></div>
            </div>
            <div id="list_part", style="display: inline;">
                <p>Listar</p>
                <input type="text" id="list_input">
                <button id="list-submit" type="submit" pys-onClick="archived">OK</button>
                <div id="list-output"></div>
            </div>
        </div>

        <py-script>
            from pyodide.http import pyfetch
            import asyncio
            from typing import List
            from datetime import datetime
            from pyodide import JsProxy



            async def get_all_repositories():
                response = await pyfetch(url="https://api.github.com/users/pedropst/repos", method="GET")
                response_dict = await response.json()

                return response_dict
            
            all_repositories = await get_all_repositories()
            
            def filter(repository:dict, key:str):
                return repository[key]
        
            def order_by(proxy: JsProxy):
                key = Element('order_input').element.value
                repositories = all_repositories
                if key == 'updated_at':
                    pyscript.write('order-output', str([x['name'] for x in sorted(repositories, key=lambda x: datetime.strptime(x['updated_at'], '%Y-%m-%dT%H:%M:%SZ'), reverse=True)]))
                elif key == 'name':
                    pyscript.write('order-output', str([x['name'] for x in sorted(repositories, key=lambda x: x['name'].lower(), reverse=False)]))
            
            def search(proxy: JsProxy):
                repositories = all_repositories
                search_word = Element('search_input').element.value
                pyscript.write('search-output', str([repository for repository in repositories if search_word.lower() in repository['name'].lower()]))
                
            def archived(proxy: JsProxy):
                repositories = all_repositories
                <!-- search_word = Element('list_input').element.value -->
                pyscript.write('list-output', str([f"{repository['name']} est√° arquivado: {repository['archived']}" for repository in repositories]))
        </py-script>
    </body>
</html>